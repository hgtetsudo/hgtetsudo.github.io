<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JGSDF Mission Board</title>
<style>
body { font-family:"Courier New", monospace; background:#ffffff; color:#000000; margin:0; padding:0; }
#bootup { position:fixed; top:0; left:0; width:100%; height:100%; background:#000; color:#00ff00; display:flex; flex-direction:column; justify-content:center; align-items:center; font-size:18px; z-index:1000; white-space:pre; }
#board { display:none; padding:20px; }
h1 { text-align:center; color:#000; }
h2 { margin-top:20px; }
.mission-board { display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:10px; }
.mission-card { background:#f0f0f0; padding:15px; border-radius:8px; display:flex; flex-direction:column; gap:10px; cursor:pointer; border:1px solid #ccc; }
.mission-card.accepted { background:#d0ffd0; }
.mission-card.completed { background:#c0c0c0; text-decoration:line-through; }
button { padding:8px 12px; border:none; border-radius:5px; background:#000; color:#fff; cursor:pointer; margin-top:5px; }
button:hover { background:#333; }
#rank { text-align:center; margin-top:10px; font-size:18px; }
.xp-bar-container { background:#eee; border-radius:8px; width:100%; height:20px; margin-top:5px; }
.xp-bar { background:#000; height:100%; border-radius:8px; width:0%; }
#log { background:#f9f9f9; padding:10px; border-radius:8px; margin-top:20px; white-space: pre-wrap; max-height:250px; overflow-y:auto; border:1px solid #ccc; }
.section { margin-top:20px; }
</style>
</head>
<body>

<div id="bootup"></div>

<div id="board">
<h1>JGSDF Mission Board</h1>

<div id="rank">Rank: Recruit ★</div>
<div class="xp-bar-container"><div class="xp-bar" id="xpBar"></div></div>
<div id="xpText" style="text-align:center; margin-top:5px;">XP: 0 / 50</div>

<div class="section">
  <h2>Available Missions</h2>
  <div id="availableMissions" class="mission-board"></div>
</div>

<div class="section">
  <h2>Accepted Missions</h2>
  <div id="acceptedMissions" class="mission-board"></div>
</div>

<h2>Mission Log</h2>
<div id="log">Your mission logs will appear here...</div>
<button onclick="downloadLog()">Export Mission Log</button>
</div>

<script>
/******** CONFIG ********/
const ranks=["Recruit ★","Private ★★","Corporal ★★★","Sergeant ★★★★","Lieutenant ★★★★★"];
const rankXP=[50,100,200,350,9999];
const XP_DAILY=5, XP_WEEKLY=15, XP_BONUS=25, XP_COMPLETE_ALL=50, XP_STREAK=10;

const dailyPool=[
  {task:"Morning Drill: Make bed & stretch 5 min",brief:"Start the day strong."},
  {task:"Room Readiness: Organize tactical gear & clean desk",brief:"Ensure barracks is inspection-ready."},
  {task:"Bike Recon: Short neighborhood patrol",brief:"Scout local area."},
  {task:"Physical Training: 10 push-ups, 10 sit-ups, 5 min stealth walk",brief:"Maintain physical readiness."},
  {task:"Evening Debrief: Write 1–2 sentence mission log",brief:"Record operations."},
  {task:"Inspect first aid kit & flashlight",brief:"Check tools for emergency readiness."},
  {task:"Hydration check: prepare water bottle",brief:"Prepare for sustained operations."},
  {task:"Check bike tires & brakes",brief:"Ensure vehicle readiness."},
  {task:"Organize stationery / tactical notebook",brief:"Keep intel in order."},
  {task:"Inspect personal clothing / uniform setup",brief:"Uniform readiness is key."}
];

const weeklyPool=[
  {task:"Supply Run: Buy Daiso or tactical gear",brief:"Resupply for next week's missions."},
  {task:"Recon Patrol: Map a 1-hr bike route",brief:"Scout and record extended routes."},
  {task:"Night Ops: Stealthy night ride",brief:"Train night mobility."},
  {task:"Disaster Prep Drill: Evacuation & emergency kit",brief:"Simulate emergency readiness."},
  {task:"Community Ops: Litter pickup or small aid delivery",brief:"Support local civilians."}
];

const bonusPool=[
  {task:"Intelligence Analyst: Map train patterns or bike routes",brief:"Gather intel on transportation."},
  {task:"Tactical Planning: Redesign room layout or bike setup",brief:"Optimize your base."},
  {task:"Long Recon: 10–15 km stealth bike ride",brief:"Extended patrol to test endurance."}
];

let state={
  currentXP:0,
  currentRank:0,
  missionLog:"",
  available:[],
  accepted:[],
  completedDaily:0,
  completedWeekly:0,
  bonusGiven:false,
  streak:0,
  lastActive:null
};

/******** STORAGE ********/
function saveState(){localStorage.setItem('jgsdfState',JSON.stringify(state));}
function loadState(){const s=localStorage.getItem('jgsdfState'); if(s){state=JSON.parse(s);}}

/******** UTIL ********/
function shuffleArray(arr){return arr.sort(()=>0.5-Math.random());}
function pickRandom(pool,count){const copy=[...pool]; shuffleArray(copy); return copy.slice(0,count);}
function sameDay(d1,d2){return new Date(d1).toDateString()===new Date(d2).toDateString();}

/******** MISSION GENERATION ********/
function autoGenerateMissions(){
  const today=new Date();
  const last=state.lastActive ? new Date(state.lastActive) : null;
  if(!last || !sameDay(last,today)){
    // Update streak
    if(last && (today - last)/(1000*60*60*24)===1) state.streak++;
    else state.streak=1;

    state.available=[];
    state.completedDaily=0;
    state.completedWeekly=0;
    state.bonusGiven=false;

    state.available.push(...pickRandom(dailyPool,6));
    state.available.push(...pickRandom(weeklyPool,6));
    if(Math.random()<0.3) state.available.push(...pickRandom(bonusPool,3));

    state.lastActive=today;
    saveState();
  }
}

/******** RENDER ********/
function renderMissions(){
  const avail=document.getElementById('availableMissions');
  avail.innerHTML="";
  state.available.forEach((m,i)=>{
    const card=document.createElement('div');
    card.className="mission-card";
    card.textContent=m.task;
    card.onclick=()=>acceptMission(i);
    avail.appendChild(card);
  });

  const accepted=document.getElementById('acceptedMissions');
  accepted.innerHTML="";
  state.accepted.forEach((m,i)=>{
    const card=document.createElement('div');
    card.className="mission-card accepted";
    card.textContent=m.task;
    const btn=document.createElement('button');
    btn.textContent="Show Briefing";
    btn.onclick=()=>showBriefing(i);
    card.appendChild(btn);
    accepted.appendChild(card);
  });
}

/******** MISSION WORKFLOW ********/
function acceptMission(idx){
  const mission=state.available.splice(idx,1)[0];
  state.accepted.push(mission);
  saveState();
  renderMissions();
}

function showBriefing(idx){
  const mission=state.accepted[idx];
  if(confirm(`MISSION BRIEFING:\n\n${mission.brief}\n\nClick OK to complete mission.`)){
    completeMission(idx);
  }
}

function completeMission(idx){
  const mission=state.accepted.splice(idx,1)[0];
  let xp=XP_DAILY;
  if(weeklyPool.some(m=>m.task===mission.task)) xp=XP_WEEKLY;
  else if(bonusPool.some(m=>m.task===mission.task)) xp=XP_BONUS;

  state.currentXP+=xp;
  state.missionLog+=`[${new Date().toLocaleDateString()}] Completed: ${mission.task} (+${xp} XP)\n`;

  if(dailyPool.some(m=>m.task===mission.task)) state.completedDaily++;
  if(weeklyPool.some(m=>m.task===mission.task)) state.completedWeekly++;

  // Bonus XP for completing all daily+weekly
  if(state.completedDaily>=6 && state.completedWeekly>=6 && !state.bonusGiven){
    state.currentXP+=XP_COMPLETE_ALL;
    state.missionLog+=`[${new Date().toLocaleDateString()}] Bonus XP for completing all daily & weekly missions (+${XP_COMPLETE_ALL} XP)\n`;
    state.bonusGiven=true;
  }

  // Streak bonus
  if(state.streak>1){
    state.currentXP+=XP_STREAK;
    state.missionLog+=`[${new Date().toLocaleDateString()}] Streak Bonus XP (+${XP_STREAK} XP)\n`;
  }

  updateRank();
  updateXPBar();
  saveState();
  renderMissions();
  document.getElementById('log').textContent=state.missionLog;
}

/******** RANK & XP ********/
function updateRank(){
  while(state.currentRank<ranks.length-1 && state.currentXP>=rankXP[state.currentRank]){
    state.currentRank++;
  }
  document.getElementById('rank').textContent=`Rank: ${ranks[state.currentRank]} | Streak: ${state.streak} day(s)`;
}

function updateXPBar(){
  const nextXP=rankXP[state.currentRank] || rankXP[rankXP.length-1];
  const percent=Math.min((state.currentXP/nextXP)*100,100);
  document.getElementById('xpBar').style.width=`${percent}%`;
  document.getElementById('xpText').textContent=`XP: ${state.currentXP} / ${nextXP}`;
}

/******** LOG ********/
function downloadLog(){
  const blob=new Blob([state.missionLog],{type:'text/plain'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download=`JGSDF_Mission_Log_${new Date().toLocaleDateString()}.txt`;
  a.click();
  URL.revokeObjectURL(url);
}

/******** CINEMATIC BOOTUP ********/
const bootText=[
  "JGSDF MISSION BOARD INITIALIZING...",
  "LOADING SYSTEM MODULES...",
  "CHECKING DAILY MISSIONS...",
  "CHECKING WEEKLY MISSIONS...",
  "CHECKING BONUS MISSIONS...",
  "ESTABLISHING CONNECTION TO CENTRAL COMMAND...",
  "ALL SYSTEMS OPERATIONAL",
  "PRESS ANY KEY TO CONTINUE..."
];

function runBootupAnimation(){
  const bootDiv=document.getElementById('bootup');
  let index=0;
  function typeLine(line,callback){
    let i=0;
    function typeChar(){
      if(i<line.length){
        bootDiv.textContent+=line[i];
        i++;
        setTimeout(typeChar,30);
      }else{
        bootDiv.textContent+="\n";
        setTimeout(callback,200);
      }
    }
    typeChar();
  }
  function nextLine(){
    if(index<bootText.length){
      typeLine(bootText[index],()=>{ index++; nextLine(); });
    }else{
      // Wait for user keypress
      document.addEventListener('keydown',finishBootup);
    }
  }
  nextLine();
}
function finishBootup(){
  document.getElementById('bootup').style.display='none';
  document.getElementById('board').style.display='block';
  autoGenerateMissions();
  renderMissions();
  updateXPBar();
  updateRank();
  document.removeEventListener('keydown',finishBootup);
}

/******** INIT ********/
window.onload=function(){
  loadState();
  runBootupAnimation();
};
</script>
</body>
</html>
